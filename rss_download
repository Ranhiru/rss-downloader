#!/usr/bin/env ruby

require 'net/http'
require 'uri'
require "rexml/document"
require 'byebug'

include REXML

class FeedList
  class Feed
    attr_accessor :name, :feed_url, :xpath, :matcher, :download_dir

    def initialize feed
      @name         = feed['name']
      @feed_url     = feed['feed_url']
      @xpath        = feed['xpath']
      @matcher      = feed['matcher']
      @download_dir = feed['download_dir']
    end
  end

  def initialize
    @yaml  = YAML.load_file(get_config_file_path)
    @feeds = []
  end

  def parse
    @yaml['feeds'].each do |feed|
      @feeds.push(Feed.new(feed))
    end
    debugger
  end

  def run

  end

  def get_rss_content
    Net::HTTP.get(URI.parse(get_url))
  end

  def get_config_file_path
    "#{Dir.home}/.rss-downloader/config.yml"
  end
end

def get_values document, xpath
  xpath_document = Document.new document
  XPath.each(xpath_document, xpath) do |node|
    if node.is_a?(Attribute)
      def node.parent
        self.element
      end
    end
    puts node.text
  end
end

@feed_list = FeedList.new
@feed_list.parse
@feed.run
